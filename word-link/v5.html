<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Word Chain</title>

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

/* ---------- THEME VARIABLES ---------- */
:root {
    --bg: #ffffff;
    --text: #111;
    --card: #ffffff;
    --border: #111;
}

body.dark {
    --bg: #111;
    --text: #ffffff;
    --card: #1a1a1a;
    --border: #ffffff;
}

/* ---------- BODY ---------- */
body {
    margin: 0;
    background:
        repeating-linear-gradient(
            45deg,
            #f3f3f3,
            #f3f3f3 2px,
            #ffffff 2px,
            #ffffff 12px
        );
    background-color: var(--bg);
    color: var(--text);
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    transition: 0.3s;
}

body.dark {
    background:
        repeating-linear-gradient(
            45deg,
            #1a1a1a,
            #1a1a1a 2px,
            #111 2px,
            #111 12px
        );
}

/* ---------- CARD ---------- */
.container {
    width: 460px;
    background: var(--card);
    border: 2px solid var(--border);
    padding: 30px;
    text-align: center;
    transition: 0.3s;
}

/* ---------- TYPOGRAPHY ---------- */
h1 { margin-top: 0; font-weight: 400; }

.current-word {
    font-size: 32px;
    margin: 15px 0;
}

.timer { font-size: 24px; margin: 10px 0; }

.score { margin-bottom: 10px; }

/* ---------- INPUT ---------- */
input {
    width: 90%;
    padding: 12px;
    background: transparent;
    color: var(--text);
    border: 2px solid var(--border);
    text-align: center;
}

/* ---------- BUTTONS ---------- */
button {
    margin: 6px;
    padding: 8px 16px;
    border: 2px solid var(--border);
    background: transparent;
    color: var(--text);
    cursor: pointer;
    transition: 0.2s;
}

button:hover {
    background: var(--text);
    color: var(--bg);
}

/* ---------- HISTORY ---------- */
.history {
    margin-top: 15px;
    max-height: 90px;
    overflow-y: auto;
    font-size: 14px;
    opacity: 0.7;
    border-top: 1px solid var(--border);
    padding-top: 8px;
}

/* ---------- OVERLAYS ---------- */
.overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
}

.hidden { display: none; }

.popup {
    background: var(--card);
    border: 2px solid var(--border);
    padding: 25px;
    width: 350px;
    text-align: center;
}

/* ---------- CUSTOM TOGGLE ---------- */
.toggle {
    display: inline-flex;
    align-items: center;
    cursor: pointer;
    margin: 6px 0;
}

.toggle input { display: none; }

.slider {
    width: 40px;
    height: 20px;
    border: 2px solid var(--border);
    margin-right: 10px;
    position: relative;
}

.slider::before {
    content: "";
    position: absolute;
    width: 14px;
    height: 14px;
    background: var(--border);
    top: 1px;
    left: 1px;
    transition: 0.2s;
}

.toggle input:checked + .slider::before {
    transform: translateX(18px);
}
</style>
</head>
<body>

<div class="container">

<h1>WORD CHAIN</h1>

<div id="gameArea" class="hidden">
    <div class="current-word" id="currentWord"></div>
    <div>Start with: <b id="requiredLetter"></b></div>

    <input id="wordInput" placeholder="Type word & press Enter">

    <div class="timer">⏳ <span id="time">10.00</span>s</div>
    <div class="score">Score: <span id="score">0</span></div>

    <button id="pauseBtn">Pause</button>
    <button onclick="openSettings()">Settings</button>

    <div class="history" id="history"></div>
</div>

</div>

<!-- HOME -->
<div id="homeScreen" class="overlay">
    <div class="popup">
        <h2>Ready?</h2>
        <button onclick="startGame()">Play</button>
        <button onclick="openSettings()">Settings</button>
    </div>
</div>

<!-- SETTINGS -->
<div id="settingsMenu" class="overlay hidden">
    <div class="popup">
        <h3>Settings</h3>

        <label class="toggle">
            <input type="checkbox" id="darkToggle">
            <div class="slider"></div>
            Dark Mode
        </label>

        <label class="toggle">
            <input type="checkbox" id="themeToggle" checked>
            <div class="slider"></div>
            Use Word Themes
        </label>

        <label class="toggle">
            <input type="checkbox" id="msToggle" checked>
            <div class="slider"></div>
            Show Milliseconds
        </label>

        <p style="font-size:13px; opacity:0.7;">
            Score = word length × remaining time bonus.
        </p>

        <button onclick="goHome()">Home</button>
        <button onclick="closeSettings()">Close</button>
    </div>
</div>

<!-- POPUP -->
<div id="customPopup" class="overlay hidden">
    <div class="popup">
        <div id="popupMessage"></div>
        <br>
        <button onclick="closePopup()">OK</button>
    </div>
</div>

<script>
const themes = {
    animals: ["tiger","rabbit","eagle","lion","zebra","panda","whale"],
    objects: ["table","engine","glass","guitar","robot","chair","phone"]
};

const mixed = [...themes.animals, ...themes.objects];

let useThemes = true;
let darkMode = false;
let showMS = true;
let score = 0;
let currentWord = "";
let usedWords = [];
let baseTime = 10;
let roundTime = baseTime;
let startTime = 0;
let animationFrame;
let paused = false;

const wordEl = document.getElementById("currentWord");
const letterEl = document.getElementById("requiredLetter");
const inputEl = document.getElementById("wordInput");
const timeEl = document.getElementById("time");
const scoreEl = document.getElementById("score");
const historyEl = document.getElementById("history");

function startGame() {
    document.getElementById("homeScreen").classList.add("hidden");
    document.getElementById("gameArea").classList.remove("hidden");
    score = 0;
    roundTime = baseTime;
    nextWord(true);
}

function getWordList() {
    if (!useThemes) return mixed;
    return Math.random() > 0.5 ? themes.animals : themes.objects;
}

function nextWord(first=false) {
    if (!first) roundTime = Math.max(3, roundTime - 0.4);

    const list = getWordList();
    currentWord = list[Math.floor(Math.random()*list.length)];
    usedWords = [currentWord];
    updateDisplay();
    startTimer();
}

function updateDisplay() {
    wordEl.textContent = currentWord;
    letterEl.textContent = currentWord.slice(-1).toUpperCase();
    historyEl.innerHTML = usedWords.join(" ➜ ");
}

function startTimer() {
    cancelAnimationFrame(animationFrame);
    startTime = performance.now();
    updateTimer();
}

function updateTimer() {
    if (paused) {
        animationFrame = requestAnimationFrame(updateTimer);
        return;
    }

    const elapsed = (performance.now() - startTime)/1000;
    const remaining = roundTime - elapsed;

    if (remaining <= 0) {
        showPopup("Game Over! Final Score: " + score);
        return;
    }

    timeEl.textContent = showMS ? remaining.toFixed(2) : Math.ceil(remaining);
    animationFrame = requestAnimationFrame(updateTimer);
}

inputEl.addEventListener("keydown", e => {
    if (e.key !== "Enter" || paused) return;

    const word = inputEl.value.trim().toLowerCase();
    if (!word) return;
    if (word[0] !== currentWord.slice(-1)) {
        showPopup("Word must start with " + currentWord.slice(-1).toUpperCase());
        return;
    }

    const remaining = parseFloat(timeEl.textContent);
    score += word.length * Math.floor(remaining * 10);
    scoreEl.textContent = score;

    currentWord = word;
    usedWords.push(word);
    updateDisplay();

    inputEl.value = "";
    startTime = performance.now();
    roundTime = Math.max(3, roundTime - 0.4);
});

function openSettings() {
    paused = true;
    document.getElementById("settingsMenu").classList.remove("hidden");
}

function closeSettings() {
    useThemes = document.getElementById("themeToggle").checked;
    showMS = document.getElementById("msToggle").checked;
    darkMode = document.getElementById("darkToggle").checked;

    document.body.classList.toggle("dark", darkMode);

    paused = false;
    document.getElementById("settingsMenu").classList.add("hidden");
}

function goHome() {
    cancelAnimationFrame(animationFrame);
    paused = false;
    document.getElementById("settingsMenu").classList.add("hidden");
    document.getElementById("gameArea").classList.add("hidden");
    document.getElementById("homeScreen").classList.remove("hidden");
}

function showPopup(msg) {
    paused = true;
    document.getElementById("popupMessage").innerText = msg;
    document.getElementById("customPopup").classList.remove("hidden");
}

function closePopup() {
    paused = false;
    document.getElementById("customPopup").classList.add("hidden");
}
</script>

</body>
</html>
